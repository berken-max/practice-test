<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Multiplication Practice (1‚Äì3 digits)</title>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --card:#111827; /* gray-900 */
      --muted:#94a3b8; /* slate-400 */
      --text:#e5e7eb; /* gray-200 */
      --accent:#22c55e; /* green-500 */
      --danger:#ef4444; /* red-500 */
      --brand:#6366f1; /* indigo-500 */
      --yellow:#f59e0b; /* amber-500 */
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:linear-gradient(180deg,#0b1225, #0f172a 40%);}    
    .wrap{max-width:840px;margin:0 auto;padding:clamp(16px,4vw,28px);}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .title{color:var(--text);font-weight:800;letter-spacing:.2px;font-size:clamp(18px,2.8vw,24px)}
    .card{background:rgba(17,24,39,.92); border:1px solid rgba(148,163,184,.18);box-shadow:0 10px 30px rgba(0,0,0,.35);border-radius:18px;padding:clamp(16px,3.2vw,28px);color:var(--text)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .grow{flex:1 1 280px}
    button{appearance:none;border:none;cursor:pointer;border-radius:12px;padding:14px 16px;font-weight:700;letter-spacing:.3px}
    .btn{background:var(--brand);color:white;}
    .btn:hover{filter:brightness(1.05)}
    .btn.secondary{background:#1f2937}
    .btn.ghost{background:transparent;border:1px solid rgba(148,163,184,.22);color:var(--text)}
    .btn.success{background:var(--accent)}
    .btn.danger{background:var(--danger)}
    .choices{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0 0}
    .chip{padding:10px 14px;border-radius:999px;background:#0b1225;border:1px solid rgba(148,163,184,.25);color:var(--text);cursor:pointer}
    .chip.active{background:var(--brand);border-color:transparent}
    .muted{color:var(--muted)}
    .problem{font-variant-numeric:tabular-nums; font-size:clamp(24px,6vw,42px); font-weight:800; letter-spacing:.6px;}
    .x{opacity:.45}
    input[type="tel"]{width:100%;font-size:clamp(22px,6vw,32px);padding:14px 16px;border-radius:12px;border:1px solid rgba(148,163,184,.28);background:#0b1225;color:var(--text);outline:none}
    input[type="tel"]:focus{border-color:var(--brand); box-shadow:0 0 0 3px rgba(99,102,241,.25)}
    .feedback{border-radius:14px;padding:12px 14px;margin-top:12px;font-weight:700;display:none}
    .feedback.ok{display:block;background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.35);color:#bbf7d0}
    .feedback.bad{display:block;background:rgba(239,68,68,.14);border:1px solid rgba(239,68,68,.35);color:#fecaca}
    .progress{height:10px;border-radius:999px;background:#0b1225;border:1px solid rgba(148,163,184,.18);overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,var(--brand),#14b8a6);width:0%}
    .grid{display:grid;gap:10px}
    @media(min-width:680px){.grid-2{grid-template-columns:1.3fr .7fr}}
    table{border-collapse:collapse;width:100%;font-variant-numeric:tabular-nums}
    td{padding:6px 8px;border-bottom:1px solid rgba(148,163,184,.18)}
    tr:last-child td{border-bottom:none}
    .help{margin-top:10px;background:#0a1224;border:1px dashed rgba(148,163,184,.35);border-radius:12px;padding:10px}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:#0b1225;border:1px solid rgba(148,163,184,.25);padding:2px 6px;border-radius:6px}
    footer{margin-top:18px;color:var(--muted);font-size:14px}
    .center{display:flex;align-items:center;justify-content:center;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">üßÆ Multiplication Practice (1‚Äì3 digits)</div>
      <button class="btn ghost" id="resetAll" title="Reset">‚Üª Reset</button>
    </header>

    <div class="card grid grid-2">
      <section class="grow">
        <div id="setup">
          <h2 style="margin:0 0 6px 0">Choose number of questions</h2>
          <div class="choices" id="countChoices"></div>
          <p class="muted">Problems are random one-, two-, or three-digit √ó one-, two-, or three-digit. No zeros.</p>
          <div style="margin-top:10px" class="row">
            <button class="btn" id="startBtn">Start Practice ‚ñ∂Ô∏é</button>
          </div>
        </div>

        <div id="exam" style="display:none">
          <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:10px">
            <div class="muted">Question <span id="qIndex">1</span>/<span id="qTotal">10</span></div>
            <div class="muted">Score: <span id="score">0</span></div>
          </div>
          <div class="progress"><div class="bar" id="bar"></div></div>

          <div style="margin:14px 0 6px" class="problem"><span id="A">123</span> <span class="x">√ó</span> <span id="B">45</span> = <span class="x">?</span></div>

          <label class="muted" for="answer">Your answer</label>
          <input id="answer" inputmode="numeric" type="tel" placeholder="Type the product" autocomplete="off" />

          <div class="row" style="margin-top:10px;gap:8px">
            <button class="btn" id="submitBtn">Submit</button>
            <button class="btn secondary" id="skipBtn" title="Mark wrong & next">Skip</button>
            <button class="btn ghost" id="showStepsBtn" title="Show help for this problem">Show Help</button>
          </div>

          <div class="feedback ok" id="goodMsg">‚úÖ Correct ‚Äî nice work!</div>
          <div class="feedback bad" id="badMsg">‚ùå Not quite. Help shown below ‚Äî study the steps, then try again.</div>

          <div id="help" class="help" style="display:none"></div>
        </div>

        <div id="results" style="display:none">
          <h2 style="margin:0 0 8px 0">All done! üéâ</h2>
          <p class="muted">You answered <span id="correctCount">0</span> out of <span id="totalCount">0</span> correctly on the first try.</p>
          <div class="row" style="margin:12px 0 18px">
            <button class="btn success" id="againBtn">Practice Again</button>
            <button class="btn ghost" id="reviewBtn">Review Mistakes</button>
          </div>
          <div id="review" style="display:none"></div>
        </div>
      </section>

      <aside>
        <h3 style="margin:0 0 8px 0">How it works</h3>
        <ol style="margin:0 0 10px 18px; color:var(--muted)">
          <li>Choose 10‚Äì50 questions and tap <span class="kbd">Start Practice</span>.</li>
          <li>Type your answer and hit <span class="kbd">Submit</span>.</li>
          <li>Green = correct ‚úîÔ∏è. Red = not correct ‚ùå and step-by-step help appears.</li>
          <li>You can <span class="kbd">Show Help</span> anytime.</li>
        </ol>
        <div class="card" style="background:#0b1225">
          <div style="font-weight:700; margin-bottom:6px">Tip for iPhone/iPad</div>
          <div class="muted">Add this page to your Home Screen in Safari: <em>Share</em> ‚Üí <em>Add to Home Screen</em>. It opens full-screen.</div>
        </div>
      </aside>
    </div>

    <footer>
      Built for quick practice. Works offline once loaded. No data leaves your device.
    </footer>
  </div>

<script>
(function(){
  const counts = [10,20,30,40,50];
  const countChoices = document.getElementById('countChoices');
  const startBtn = document.getElementById('startBtn');
  const setup = document.getElementById('setup');
  const exam = document.getElementById('exam');
  const results = document.getElementById('results');
  const qIndexEl = document.getElementById('qIndex');
  const qTotalEl = document.getElementById('qTotal');
  const scoreEl = document.getElementById('score');
  const bar = document.getElementById('bar');
  const Ael = document.getElementById('A');
  const Bel = document.getElementById('B');
  const answer = document.getElementById('answer');
  const submitBtn = document.getElementById('submitBtn');
  const skipBtn = document.getElementById('skipBtn');
  const showStepsBtn = document.getElementById('showStepsBtn');
  const goodMsg = document.getElementById('goodMsg');
  const badMsg = document.getElementById('badMsg');
  const help = document.getElementById('help');
  const againBtn = document.getElementById('againBtn');
  const correctCount = document.getElementById('correctCount');
  const totalCount = document.getElementById('totalCount');
  const reviewBtn = document.getElementById('reviewBtn');
  const review = document.getElementById('review');
  const resetAll = document.getElementById('resetAll');

  let questionTotal = 10;
  let idx = 0;
  let score = 0;
  let questions = [];
  let firstTryCorrect = [];
  let sawHelp = false;

  // Build count chips
  counts.forEach(c=>{
    const chip=document.createElement('button');
    chip.className='chip'+(c===questionTotal?' active':'');
    chip.textContent=c+" questions";
    chip.onclick=()=>{
      questionTotal=c; updateChips();
    };
    chip.dataset.value=c;
    countChoices.appendChild(chip);
  });
  function updateChips(){
    [...countChoices.children].forEach(ch=>{
      ch.classList.toggle('active', Number(ch.dataset.value)===questionTotal);
    })
  }

  function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}
  function pickFactor(){ // 1-3 digit, no zero
    const digits = randInt(1,3);
    const low = digits===1?1:(digits===2?10:100);
    const high = digits===1?9:(digits===2?99:999);
    return randInt(low,high);
  }
  function makeProblem(){
    return {a: pickFactor(), b: pickFactor()};
  }

  function formatNum(n){return n.toLocaleString('en-US')}

  function renderHelp(a,b){
    const bs = String(b).padStart(3,' ').split('').reverse().map(d=>Number(d));
    const ones=bs[0]||0, tens=bs[1]||0, hundreds=bs[2]||0;
    const p1=a*ones;
    const p2=a*tens;
    const p3=a*hundreds;
    const lines=[];
    lines.push(`<div style="font-weight:700;margin-bottom:6px">Step-by-step (long multiplication)</div>`);
    lines.push(`<table>
      <tr><td style="width:40%">Problem</td><td>${formatNum(a)} √ó ${formatNum(b)}</td></tr>
      <tr><td>Ones (√ó ${ones})</td><td>${formatNum(p1)}${ones?"":" (zero)"}</td></tr>
      <tr><td>Tens (√ó ${tens})</td><td>${formatNum(p2)} ${tens?"‚Üí add a 0":"(zero)"}</td></tr>
      <tr><td>Hundreds (√ó ${hundreds})</td><td>${formatNum(p3)} ${hundreds?"‚Üí add 00":"(zero)"}</td></tr>
      <tr><td style="font-weight:700">Add them up</td><td style="font-weight:700">${formatNum(p1 + p2*10 + p3*100)}</td></tr>
    </table>`);
    lines.push(`<div class="muted" style="margin-top:6px">Tip: multiply by each digit of the bottom number (ones, tens, hundreds), then add with the right number of zeros.</div>`);
    return lines.join('');
  }

  function nextQuestion(){
    if(idx>=questionTotal){
      // finish
      setup.style.display='none'; exam.style.display='none'; results.style.display='block';
      correctCount.textContent = score;
      totalCount.textContent = questionTotal;
      renderReview();
      return;
    }
    const q = questions[idx];
    qIndexEl.textContent = idx+1;
    qTotalEl.textContent = questionTotal;
    Ael.textContent = q.a; Bel.textContent = q.b;
    answer.value=''; answer.focus();
    goodMsg.style.display='none'; badMsg.style.display='none'; help.style.display='none'; help.innerHTML='';
    sawHelp=false;
    const pct = Math.round((idx/questionTotal)*100);
    bar.style.width = pct+"%";
  }

  function check(){
    const q = questions[idx];
    const val = Number((answer.value||'').replace(/[^\d-]/g,''));
    const correct = q.a * q.b;
    if(val === correct){
      goodMsg.style.display='block'; badMsg.style.display='none';
      firstTryCorrect[idx] = !sawHelp; // only count true if help not shown
      if(!sawHelp) score++;
      setTimeout(()=>{ idx++; nextQuestion(); }, 650);
    }else{
      badMsg.style.display='block';
      if(!sawHelp){
        help.innerHTML = renderHelp(q.a, q.b);
        help.style.display='block';
        sawHelp=true;
      }
    }
  }

  function renderReview(){
    const rows = questions.map((q,i)=>{
      const prod = q.a*q.b;
      const status = firstTryCorrect[i] ? '‚úÖ' : '‚ùå';
      const line = `<tr>
        <td style="white-space:nowrap">${i+1}</td>
        <td>${formatNum(q.a)} √ó ${formatNum(q.b)}</td>
        <td>${formatNum(prod)}</td>
        <td>${status}</td>
      </tr>`;
      return line;
    }).join('');
    review.innerHTML = `<div class="card" style="padding:0">
      <div style="padding:12px 14px;font-weight:700;border-bottom:1px solid rgba(148,163,184,.18)">Review</div>
      <div style="max-height:320px;overflow:auto">
        <table>
          <tr><td>#</td><td>Problem</td><td>Answer</td><td>First try</td></tr>
          ${rows}
        </table>
      </div>
    </div>`;
  }

  startBtn.addEventListener('click', ()=>{
    // Seed new exam
    questions = Array.from({length:questionTotal}, makeProblem);
    firstTryCorrect = Array(questionTotal).fill(false);
    score=0; idx=0;
    setup.style.display='none'; exam.style.display='block'; results.style.display='none';
    nextQuestion();
  });

  submitBtn.addEventListener('click', check);
  skipBtn.addEventListener('click', ()=>{ 
    badMsg.style.display='block';
    const q = questions[idx];
    help.innerHTML = renderHelp(q.a, q.b);
    help.style.display='block';
    sawHelp=true; firstTryCorrect[idx]=false;
    setTimeout(()=>{ idx++; nextQuestion(); }, 650);
  });
  showStepsBtn.addEventListener('click', ()=>{
    const q = questions[idx];
    help.innerHTML = renderHelp(q.a, q.b);
    help.style.display='block';
    sawHelp=true;
  });
  answer.addEventListener('keydown', (e)=>{
    if(e.key==='Enter') check();
  });

  againBtn.addEventListener('click', ()=>{
    setup.style.display='block'; exam.style.display='none'; results.style.display='none';
  });
  reviewBtn.addEventListener('click', ()=>{
    review.style.display = review.style.display==='none' ? 'block':'none';
  });
  resetAll.addEventListener('click', ()=>{
    location.reload();
  });

  // iOS: keep input visible when keyboard opens (scroll into view)
  answer.addEventListener('focus', ()=>{
    setTimeout(()=>{ answer.scrollIntoView({behavior:'smooth',block:'center'}); }, 150);
  });
})();
</script>
</body>
</html>
