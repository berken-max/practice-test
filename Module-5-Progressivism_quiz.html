<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Class Notes Practice Test</title>
<style>
:root{
  --bg:#0a0c10; --card:#11151a; --ink:#e7ecf3; --muted:#a9b3c2;
  --line:rgba(255,255,255,.10); --accent:#5aa7ff; --good:#34c759; --bad:#ff3b30; --warn:#ff9f0a;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.5 -apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,sans-serif}
.wrap{max-width:820px;margin:0 auto;padding:16px}
header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(10,12,16,.98),rgba(10,12,16,.85));backdrop-filter:blur(6px);border-bottom:1px solid var(--line)}
header .row{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 16px}
h1{font-size:18px;margin:0;font-weight:800;letter-spacing:.2px}
.seg{display:inline-flex;border:1px solid var(--line);border-radius:12px;overflow:hidden}
.seg button{border:0;background:transparent;color:var(--ink);padding:8px 12px;font-weight:700}
.seg button.active{background:var(--accent);color:#001a33}
.card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:16px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media (max-width:680px){.row2{grid-template-columns:1fr}}
label{display:block;font-size:13px;color:var(--muted);margin:6px 0}
select,input[type="number"],input[type="text"],textarea{
  width:100%;background:#0c1016;border:1px solid var(--line);border-radius:12px;color:var(--ink);padding:10px 12px;font-size:16px
}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;border:1px solid var(--line);border-radius:14px;background:#121922;color:var(--ink);padding:12px 14px;font-weight:800}
.btn.primary{background:var(--accent);color:#001a33;border-color:transparent}
.btn.good{background:var(--good);color:#001a33;border-color:transparent}
.btn.warn{background:var(--warn);color:#201400;border-color:transparent}
.btn.ghost{background:transparent}
.btn:active{transform:translateY(1px)}
.hidden{display:none!important}
.center{text-align:center}
.kbd{font-family:ui-monospace,Menlo,monospace;background:#0b0f14;border:1px solid var(--line);border-radius:8px;padding:2px 6px}
.pill{display:inline-block;padding:2px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted);font-size:12px}
.progress{height:10px;background:#0c1016;border:1px solid var(--line);border-radius:999px;overflow:hidden}
.progress > div{height:100%;background:var(--accent);width:0%}
.choice{display:block;text-align:left;width:100%;background:#0c1016;border:1px solid var(--line);border-radius:12px;padding:12px;margin:6px 0}
.choice.correct{border-color:rgba(52,199,89,.7)}
.choice.wrong{border-color:rgba(255,59,48,.7)}
.choice[disabled]{opacity:.8}
.divider{height:1px;background:var(--line);margin:12px 0}
.option{background:#0e1116;border:1px solid var(--line);border-radius:12px;padding:10px}
footer{color:var(--muted);font-size:12px}
</style>
</head>
<body>
<header>
  <div class="row wrap">
    <h1 id="title">Class Notes Practice Test</h1>
    <div class="seg" role="tablist" aria-label="Mode">
      <button id="tab-study" class="active" onclick="setMode('study')">Study</button>
      <button id="tab-test" onclick="setMode('test')">Test</button>
      <button id="tab-editor" onclick="setMode('editor')">Editor</button>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- Controls -->
  <section id="controls" class="card">
    <div class="row2">
      <div>
        <label>Question Count</label>
        <select id="qCount">
          <option>10</option><option>20</option><option selected>30</option><option>40</option><option>50</option><option>All</option>
        </select>
      </div>
      <div>
        <label>Shuffle</label>
        <select id="shuffle">
          <option value="on" selected>On</option>
          <option value="off">Off</option>
        </select>
      </div>
    </div>
    <div class="divider"></div>
    <div class="row2">
      <div><button class="btn primary" onclick="startSession()">Start</button></div>
      <div class="center" style="display:flex;gap:10px;align-items:center;justify-content:flex-end">
        <span class="pill">Progress: <span id="idx">0</span>/<span id="total">0</span></span>
        <div class="progress" style="min-width:160px"><div id="bar"></div></div>
      </div>
    </div>
  </section>

  <!-- Quiz Panel -->
  <section id="panel" class="card hidden" aria-live="polite">
    <div id="qtext" style="font-size:18px;font-weight:800"></div>
    <div id="choices"></div>
    <div id="tf" class="hidden" style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
      <button class="btn choice" onclick="pick('True')">True</button>
      <button class="btn choice" onclick="pick('False')">False</button>
    </div>
    <div id="feedback" class="hidden" style="margin-top:10px"></div>
    <div class="divider"></div>
    <div style="display:flex;gap:10px;justify-content:space-between">
      <button class="btn" onclick="prevQ()">Prev</button>
      <button class="btn" onclick="nextQ()">Next</button>
      <button class="btn good hidden" id="finishBtn" onclick="finish()">Finish Test</button>
    </div>
  </section>

  <!-- Review -->
  <section id="review" class="card hidden">
    <div class="center" style="margin-bottom:8px">
      <div id="score" style="font-size:32px;font-weight:900">—</div>
      <div class="pill" id="meta">—</div>
    </div>
    <div id="missed"></div>
  </section>

  <!-- Editor -->
  <section id="editor" class="card hidden">
    <p style="color:var(--muted)">Use this to paste or edit questions from your notes. <b>Saved locally</b> on the device. Export/Import JSON to reuse.</p>
    <div class="row2">
      <div>
        <label>Quiz Title</label>
        <input id="etitle" type="text" placeholder="e.g., Unit 3 – Notes Review" />
      </div>
      <div style="display:flex;gap:10px;align-items:flex-end;justify-content:flex-end">
        <button class="btn" onclick="saveTitle()">Save Title</button>
        <button class="btn" onclick="exportJSON()">Export JSON</button>
        <label class="btn" for="importFile">Import JSON</label>
        <input id="importFile" type="file" class="hidden" accept="application/json" />
      </div>
    </div>
    <div class="divider"></div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button class="btn good" onclick="addQ()">Add Question</button>
      <button class="btn warn" onclick="clearAll()">Clear All</button>
      <span class="pill">Saved: <span id="savedCount">0</span></span>
    </div>
    <div id="elist" style="margin-top:10px"></div>
  </section>

  <div style="height:12px"></div>
  <footer class="center">Tip: On iPhone, open in Safari → Share → <b>Add to Home Screen</b> for a fullscreen experience.</footer>
</main>

<script>
/* ====== Data Model ====== */
const QKEY="cn_quiz_questions_v3", META="cn_quiz_meta_v3";

function uid(){return Math.random().toString(36).slice(2,10)}
function loadQ(){try{return JSON.parse(localStorage.getItem(QKEY)||"[]")}catch(e){return[]}}
function saveQ(arr){localStorage.setItem(QKEY,JSON.stringify(arr));document.getElementById('savedCount').textContent=String(arr.length)}
function loadMeta(){try{return JSON.parse(localStorage.getItem(META)||"{}")}catch(e){return{}}}
function saveMeta(m){localStorage.setItem(META,JSON.stringify(m))}

/* ====== Modes ====== */
let MODE="study"; // 'study' | 'test' | 'editor'
function setMode(m){
  MODE=m;
  ['study','test','editor'].forEach(x=>document.getElementById('tab-'+x).classList.toggle('active',x===m));
  document.getElementById('editor').classList.toggle('hidden',m!=='editor');
  document.getElementById('controls').classList.toggle('hidden',m==='editor');
  document.getElementById('panel').classList.add('hidden');
  document.getElementById('review').classList.add('hidden');
}

/* ====== Editor ====== */
function makeRow(q){
  const wrap=document.createElement('div'); wrap.className='option'; wrap.style.margin='10px 0';
  wrap.innerHTML=`
    <div class="row2">
      <div><label>Question</label><textarea data-k="text" rows="2">${q.text||''}</textarea></div>
      <div>
        <label>Type</label>
        <select data-k="type">
          <option value="mc"${q.type==='mc'?' selected':''}>Multiple Choice</option>
          <option value="tf"${q.type==='tf'?' selected':''}>True/False</option>
        </select>
      </div>
    </div>
    <div class="row2">
      <div><label>Correct Answer</label><input data-k="answer" type="text" value="${q.answer||''}" /></div>
      <div><label>Explanation (optional)</label><input data-k="explain" type="text" value="${q.explain||''}" /></div>
    </div>
    <div class="row2">
      <div><label>Choice A (MC)</label><input data-k="a" type="text" value="${(q.choices&&q.choices[0])||''}"/></div>
      <div><label>Choice B (MC)</label><input data-k="b" type="text" value="${(q.choices&&q.choices[1])||''}"/></div>
    </div>
    <div class="row2">
      <div><label>Choice C (MC)</label><input data-k="c" type="text" value="${(q.choices&&q.choices[2])||''}"/></div>
      <div><label>Choice D (MC)</label><input data-k="d" type="text" value="${(q.choices&&q.choices[3])||''}"/></div>
    </div>
    <div style="display:flex;gap:10px;justify-content:flex-end">
      <button class="btn" data-act="dup">Duplicate</button>
      <button class="btn warn" data-act="del">Delete</button>
      <button class="btn good" data-act="save">Save</button>
    </div>`;
  const get = k => wrap.querySelector(`[data-k="${k}"]`).value.trim();
  wrap.querySelector('[data-act="save"]').onclick=()=>{
    const data={id:q.id,text:get('text'),type:wrap.querySelector('[data-k="type"]').value,answer:get('answer'),explain:get('explain'),
      choices:[get('a'),get('b'),get('c'),get('d')].filter(Boolean)};
    const arr=loadQ(); const i=arr.findIndex(x=>x.id===q.id);
    if(i>=0) arr[i]=data; else arr.push(data);
    saveQ(arr); toast('Saved');
  };
  wrap.querySelector('[data-act="del"]').onclick=()=>{
    const arr=loadQ().filter(x=>x.id!==q.id); saveQ(arr); wrap.remove(); toast('Deleted');
  };
  wrap.querySelector('[data-act="dup"]').onclick=()=>{
    const arr=loadQ(); const dup={...q,id:uid()}; arr.push(dup); saveQ(arr); document.getElementById('elist').appendChild(makeRow(dup)); toast('Duplicated');
  };
  return wrap;
}
function addQ(){ const q={id:uid(),type:'mc',text:'',answer:'',explain:'',choices:['','','','']}; const arr=loadQ(); arr.push(q); saveQ(arr); document.getElementById('elist').appendChild(makeRow(q))}
function clearAll(){ if(!confirm('Clear ALL saved questions?'))return; saveQ([]); document.getElementById('elist').innerHTML=''; }
function renderEditor(){
  const list=document.getElementById('elist'); list.innerHTML=''; loadQ().forEach(q=>list.appendChild(makeRow(q)));
  document.getElementById('savedCount').textContent=String(loadQ().length);
  document.getElementById('etitle').value=(loadMeta().title||'');
}
function exportJSON(){
  const blob=new Blob([JSON.stringify({title:loadMeta().title||'',questions:loadQ()},null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=(loadMeta().title||'class-notes')+'.json'; a.click(); URL.revokeObjectURL(url);
}
document.getElementById('importFile').addEventListener('change',e=>{
  const f=e.target.files?.[0]; if(!f) return; const r=new FileReader();
  r.onload=()=>{ try{ const data=JSON.parse(r.result);
    if(Array.isArray(data)) saveQ(data);
    else if (data && Array.isArray(data.questions)) { saveQ(data.questions); if (data.title) saveMeta({title:data.title}) }
    renderEditor(); toast('Imported'); }catch(err){ alert('Could not import JSON: '+err.message) } };
  r.readAsText(f);
});
function saveTitle(){ saveMeta({title:document.getElementById('etitle').value.trim()}); document.getElementById('title').textContent=document.getElementById('etitle').value.trim()||'Class Notes Practice Test'; toast('Title saved')}

/* ====== Quiz Engine ====== */
let S=null; // session

function startSession(){
  const base=[...loadQ()];
  if(!base.length){ alert('No questions saved. Load sample or use the Editor to add questions from your notes.'); return; }
  let pool=[...base];
  if(document.getElementById('shuffle').value==='on') pool=shuffle(pool);
  const sel=document.getElementById('qCount').value; const take=(sel==='All')?pool.length:Math.min(parseInt(sel,10),pool.length);
  const items=pool.slice(0,take).map(q=>({
    id:q.id, type:q.type, text:q.text, answer:q.answer, explain:q.explain||'',
    choices:q.type==='mc'?shuffle(unique([...(q.choices||[]), q.answer])).slice(0,4):null,
    user:null, result:null
  }));
  S={mode:MODE, idx:0, items, start:Date.now(), finished:false};
  document.getElementById('total').textContent=String(items.length);
  document.getElementById('panel').classList.remove('hidden');
  document.getElementById('review').classList.add('hidden');
  document.getElementById('finishBtn').classList.toggle('hidden', MODE!=='test');
  renderQ();
}

function renderQ(){
  const it=S.items[S.idx];
  document.getElementById('idx').textContent=String(S.idx+1);
  document.getElementById('total').textContent=String(S.items.length);
  document.getElementById('bar').style.width=((S.idx)/Math.max(1,S.items.length))*100+'%';
  document.getElementById('qtext').textContent=it.text;

  const choices=document.getElementById('choices'); const tf=document.getElementById('tf'); const fb=document.getElementById('feedback');
  fb.classList.add('hidden'); fb.innerHTML='';
  if(it.type==='tf'){
    choices.classList.add('hidden'); tf.classList.remove('hidden');
  }else{
    tf.classList.add('hidden'); choices.classList.remove('hidden'); choices.innerHTML='';
    (it.choices||[it.answer]).forEach(c=>{
      const b=document.createElement('button'); b.className='choice'; b.textContent=c;
      b.onclick=()=>pick(c); choices.appendChild(b);
    });
  }
}

function pick(sel){
  const it=S.items[S.idx];
  it.user=sel;
  const correct = norm(sel)===norm(it.answer);
  it.result=correct;
  if(S.mode==='study'){
    const fb=document.getElementById('feedback'); fb.classList.remove('hidden');
    fb.innerHTML = correct ? `<div class="choice correct">✅ Correct! ${esc(it.explain)}</div>`
                           : `<div class="choice wrong">❌ Not quite. Correct: <span class="kbd">${esc(it.answer)}</span>${it.explain?'<br>'+esc(it.explain):''}</div>`;
  }
}

function nextQ(){ if(!S) return; if(S.idx<S.items.length-1){S.idx++; renderQ()} else if(S.mode==='test'){ finish() } }
function prevQ(){ if(!S) return; if(S.idx>0){S.idx--; renderQ()} }
function finish(){
  if(!S || S.finished) return; S.finished=true;
  const total=S.items.length, correct=S.items.filter(x=>x.result===true).length, pct=Math.round((correct/Math.max(1,total))*100);
  document.getElementById('score').textContent=`${correct}/${total} (${pct}%)`;
  document.getElementById('meta').textContent=`Completed ${new Date().toLocaleString()}`;
  const missed=document.getElementById('missed'); missed.innerHTML='';

  const wrong=S.items.filter(x=>x.result!==true);
  if(!wrong.length){ missed.innerHTML='<div class="center">🎉 Perfect score! No missed questions.</div>'; }
  else{
    wrong.forEach((x,i)=>{
      const div=document.createElement('div'); div.className='option'; div.style.margin='10px 0';
      div.innerHTML = `
        <div style="font-weight:800;margin-bottom:6px">Q${i+1}. ${esc(x.text)}</div>
        <div style="color:var(--muted);margin-bottom:4px">Your answer: <span class="kbd">${esc(x.user ?? '—')}</span></div>
        <div style="color:var(--muted)">Correct: <span class="kbd">${esc(x.answer)}</span></div>
        ${x.explain?`<div style="margin-top:6px;color:var(--muted)">Explanation: ${esc(x.explain)}</div>`:''}
      `;
      missed.appendChild(div);
    });
  }
  document.getElementById('review').classList.remove('hidden');
  setMode('test'); // ensure header state
  document.getElementById('panel').classList.add('hidden');
}

/* ====== Utils ====== */
function shuffle(a){const arr=[...a]; for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr}
function unique(a){return [...new Set(a.filter(Boolean))]}
function norm(s){return (s||'').toString().trim().toLowerCase().replace(/\s+/g,' ')}
function esc(s){return (s??'').toString().replace(/[&<>\"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":'&#39;'}[m]))}
function toast(msg){
  let el=document.getElementById('toast');
  if(!el){ el=document.createElement('div'); el.id='toast'; el.style.position='fixed'; el.style.left='50%'; el.style.bottom='calc(env(safe-area-inset-bottom) + 24px)'; el.style.transform='translateX(-50%)'; el.style.background='rgba(0,0,0,.85)'; el.style.color='white'; el.style.padding='10px 14px'; el.style.borderRadius='12px'; el.style.fontWeight='800'; el.style.boxShadow='0 8px 26px rgba(0,0,0,.4)'; document.body.appendChild(el); }
  el.textContent=msg; el.style.opacity='1'; setTimeout(()=>el.style.opacity='0',1400);
}

/* ====== Boot: preload with a small sample so it's usable immediately ====== */
const SAMPLE=[
  {id:uid(),type:'mc',text:'Example MC: Which option best describes Study Mode?',answer:'Instant feedback after each answer',explain:'Study Mode shows correct/incorrect immediately.',choices:['Score only at end','No feedback','Shuffles disabled','Instant feedback after each answer']},
  {id:uid(),type:'mc',text:'Example MC: What does the progress chip show?',answer:'Current question over total (e.g., 12/50)',choices:['Elapsed time','Accuracy % only','Device battery','Current question over total (e.g., 12/50)']},
  {id:uid(),type:'tf',text:'Example T/F: Test Mode waits until the end to show your score.',answer:'True',explain:'You get a summary plus missed questions at the end.'},
  {id:uid(),type:'tf',text:'Example T/F: Questions and answer order can be shuffled.',answer:'True'},
  {id:uid(),type:'mc',text:'Example MC: Which button ends a Test session?',answer:'Finish Test',choices:['Submit Answer','Review Now','Start Over','Finish Test']},
  {id:uid(),type:'tf',text:'Example T/F: This file is fully self-contained (no external JS/CSS).',answer:'True'}
];
if(!loadQ().length){ saveQ(SAMPLE) }
const meta=loadMeta(); if(meta.title) document.getElementById('title').textContent=meta.title;

document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('savedCount').textContent=String(loadQ().length);
  renderEditor();
});
</script>
</body>
</html>
